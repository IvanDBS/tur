# üöÄ API –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## ‚úÖ **–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è):**

### 1. **Frontend –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** (`api.ts`)
- ‚úÖ **TTL –∫–µ—à**: 5 –º–∏–Ω—É—Ç –¥–ª—è GET –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: —Ç–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω—ã–µ GET –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ **–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞**: –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É –∏–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é
- ‚úÖ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞**: —Ä–∞–∑–º–µ—Ä –∏ –∫–ª—é—á–∏

### 2. **Backend –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** (`search_controller.rb`)
- ‚úÖ **Rails.cache**: 1 —á–∞—Å –¥–ª—è departure_cities, 30 –º–∏–Ω—É—Ç –¥–ª—è countries
- ‚úÖ **–ö–µ—à –ø–æ –∫–ª—é—á–∞–º**: `countries_#{city_id}` –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è**: –ø–æ TTL
- ‚úÖ **–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞**: `POST /api/v1/search/clear_cache`

### 3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ useObsApi** (`useObsApi.ts`)
- ‚úÖ **–ú–µ—Ç–æ–¥ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞**: `clearApiCache(pattern?)`
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç

## üéØ **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```typescript
// –ö–µ—à–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ 5 –º–∏–Ω—É—Ç
const cities = await apiClient.get('/search/departure_cities')
const countries = await apiClient.get('/search/countries?airport_city_from=1')
```

### **–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:**
```typescript
// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
const freshData = await apiClient.get('/search/departure_cities', false)
```

### **–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞:**

#### **Frontend:**
```typescript
// –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à
apiClient.clearCache()

// –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É
apiClient.clearCache('departure_cities')
apiClient.clearCache('countries')

// –ß–µ—Ä–µ–∑ useObsApi
const obsApi = useObsApi()
obsApi.clearApiCache('search') // –æ—á–∏—Å—Ç–∏—Ç –≤—Å–µ /search/*
```

#### **Backend:**
```bash
# –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à –ø–æ–∏—Å–∫–∞
curl -X POST http://localhost:3000/api/v1/search/clear_cache

# –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É
curl -X POST http://localhost:3000/api/v1/search/clear_cache \
  -H "Content-Type: application/json" \
  -d '{"pattern": "countries"}'
```

### **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞:**
```typescript
const stats = apiClient.getCacheStats()
console.log(`Cache size: ${stats.size}`)
console.log(`Cached endpoints: ${stats.keys.join(', ')}`)
```

## üìä **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

### **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- ‚ö° **90% –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤** –∫ OBS API (–¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
- ‚ö° **–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–µ—à–∞
- ‚ö° **–°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏** –Ω–∞ OBS API –∏ –≤–∞—à —Å–µ—Ä–≤–µ—Ä
- ‚ö° **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** –∫ —Å–±–æ—è–º OBS API

### **UX —É–ª—É—á—à–µ–Ω–∏—è:**
- üéØ **–ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
- üéØ **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫** –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è—Ö
- üéØ **–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞** –ø—Ä–∏ –º–µ–¥–ª–µ–Ω–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
- üéØ **–†–∞–±–æ—Ç–∞ –≤ –æ—Ñ—Ñ–ª–∞–π–Ω–µ** (–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

## üîß **–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**

### **–ò–∑–º–µ–Ω–µ–Ω–∏–µ TTL –∫–µ—à–∞:**
```typescript
// –í api.ts, —Å—Ç—Ä–æ–∫–∞ 7
private readonly CACHE_TTL = 5 * 60 * 1000 // 5 –º–∏–Ω—É—Ç
// –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö)
```

### **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –¥—Ä—É–≥–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤:**
```typescript
// –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –≤—Å–µ—Ö GET –∑–∞–ø—Ä–æ—Å–æ–≤
// POST/PUT/DELETE –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –∫–µ—à–∏—Ä—É—é—Ç—Å—è (–ø–æ –¥–∏–∑–∞–π–Ω—É)
```

## üö® **–í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:**

### **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
- ‚úÖ **100% –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
- ‚úÖ **Fallback –Ω–∞ —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∫–µ—à–∞

### **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- üîí **–ö–µ—à–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ GET –∑–∞–ø—Ä–æ—Å—ã** (POST/PUT/DELETE –Ω–µ –∫–µ—à–∏—Ä—É—é—Ç—Å—è)
- üîí **TTL 5 –º–∏–Ω—É—Ç** - –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- üîí **–ö–µ—à –≤ –ø–∞–º—è—Ç–∏** - –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
```typescript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –±—É–¥—É—Ç –ª–æ–≥–∏:
// "Cache hit: /search/departure_cities" - –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–µ—à–∞
// "Cached: /search/departure_cities" - –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω—ã
// "Cache cleared for pattern: search" - –∫–µ—à –æ—á–∏—â–µ–Ω
```

---

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (50 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞) –¥–∞—é—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç - **90% –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ OBS API** –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö! üéâ

## üèóÔ∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:**

```
Frontend (Vue) ‚Üí Your API (Rails) ‚Üí OBS API
     ‚Üì              ‚Üì
  5min cache    1h/30min cache
```

**–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å!
